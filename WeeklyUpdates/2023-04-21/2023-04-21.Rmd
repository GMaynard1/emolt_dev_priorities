---
title: "eMOLT Update"
author: "George Maynard"
date: "`r Sys.Date()`"  
output: 
  blastula::blastula_email:
    toc: FALSE
    toc_depth: 3
    toc_float: TRUE
    fig_caption: FALSE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(blastula)
library(marmap)
library(rstudioapi)
source("C:/Users/george.maynard/Documents/GitHubRepos/emolt_serverside/API/API_header.R")
today=Sys.Date()
lastWeek=today-days(7)
db_config=config::get(file="C:/Users/george.maynard/Documents/GitHubRepos/emolt_serverside/API/config.yml")$dev_intranet
conn=dbConnector(db_config)
```

<center> 

<font size="5"> *eMOLT Update `r Sys.Date()` * </font>

</center>

Thirty four Minilog temperature probes were mailed out to most of the original eMOLT lobstermen a few weeks ago. These non-realtime sensors have been recording hourly bottom temperatures at most of the sites for 20 years or more during the fishing season. As seen in the photo below, JiM got help from his granddaughters in the annual envelope-stuffing routine.
![minilogs_2023_mailing]('minilogs_2023_mailing.jpg')
![minilogs_2023_mailing_with_kids]('minilogs_2023_mailing_kids.jpg')

Sixteen multi-month time series of hourly bottom temperatures collected by several Maine lobstermen in 2022 as part of the Division of Marine Resources Ventless Trap Program were processed, plotted, and archived this week to become part of the master database. See emolt.org/dmr and scroll down to the bottom to see a list of names.

A few of us met in Newport RI this past week to participate in the [https://theoceanracenewport.com/schedule]['https://theoceanracenewport.com/schedule'] Ocean Race activities including presentations on eMOLT by JiM, on Educational Passages Miniboat Program by Cassie, and on the StudentDrifter Program by Kristi Burkholder (Stonehill Oceanographer) during Thursday's "Citizen Science" session.

We are watching a few drifters move along the coast in the past month as seen at [https://studentdrifters.org/tracks/drift_X.html]['https://studentdrifters.org/tracks/drift_X.html']. One of them, deployed by F/V Captain B on Jeffreys Ledge back in late March, may be running down the backside of Cape Cod this weekend. One of them, deployed by Mississippi's Dept of Natural Resouces off Biloxi back in early March, is headed to Galveston Bay in Texas. While the drifter program slowed during the Covid years, Erin and Kristi are making progress in recent months to restart it.

### Realtime Summary (Vessels with Rockblock Satellite Transmitters)

This week, we received `r nrow(dbGetQuery(conn=conn,statement=paste0("SELECT * FROM VESSEL_STATUS WHERE TIMESTAMP >'", lastWeek, "' AND REPORT_TYPE = 'SUMMARY_DATA' AND VESSEL_ID != 23")))` haul-averaged reports from `r nrow(dbGetQuery(conn=conn, statement=paste0("SELECT DISTINCT VESSEL_ID FROM VESSEL_STATUS WHERE TIMESTAMP >'", lastWeek,"' AND REPORT_TYPE = 'SUMMARY_DATA' AND VESSEL_ID != 23")))` vessels. 

```{r statusPlot, dev='png',echo=FALSE, fig.width=8,fig.height=6,fig.show='hide',include=FALSE}
dbDisconnectAll()
conn=dbConnector(db_config)
lastweek=Sys.Date()-days(7)
data=dbGetQuery(
  conn=conn,
  statement=paste0(
    "SELECT * FROM VESSEL_STATUS WHERE TIMESTAMP > '",
    lastweek,
    "' AND VESSEL_ID != 23"
  )
)
data=select(data,REPORT_TYPE,LATITUDE,LONGITUDE,TIMESTAMP)
bath=readGEBCO.bathy(
  file="C:/Users/george.maynard/Documents/GitHubRepos/emolt_project_management/UtilityScripts/GEBCO/gebco_2022_n47.0_s38.0_w-76.0_e-59.0.nc",
  resolution=10
)
## Create color ramp
blues=c(
  "lightsteelblue4", 
  "lightsteelblue3",
  "lightsteelblue2", 
  "lightsteelblue1"
)
## Plotting the bathymetry with different colors for land and sea
plot(
  bath,
  step=100,
  deepest.isobath=-1000,
  shallowest.isobath=0,
  col="darkgray",
  image = TRUE, 
  land = TRUE, 
  lwd = 0.1,
  bpal = list(
    c(0, max(bath), "gray"),
    c(min(bath),0,blues)
  ),
  main=paste0("ALL eMOLT VESSELS with Satellite Transmitters \nREPORTS FROM: ",lastweek," to ",Sys.Date())
)
## Plot the status report locations
x=subset(data,data$REPORT_TYPE=="SHORT_STATUS")
points(
  x$LATITUDE~x$LONGITUDE,
  pch=1,
  col='red',
  cex=2
)
## Plot data uploads
x=subset(data,data$REPORT_TYPE=="SUMMARY_DATA")
points(
  x$LATITUDE~x$LONGITUDE,
  pch=1,
  col='blue',
  cex=2
)
legend(
  'topleft',
  col=c('blue','red'),
  legend=c('Summary Data Upload','Status Report'),
  pch=c(1,1),
  bty='n',
  bg=NULL,
  border='black'
)
```

![Status plot.](`r knitr::fig_chunk('statusPlot', 'png')`)
*eMOLT Satellite Transmitter status plot for the previous week.*
In the figure above, you can see the approximate locations where we received "Status Reports" (a ping from your system letting us know that it's still working) and "Data Uploads" (actual temperature / depth data collected by your probes). The "Status Reports" come in every 12 hours or so when a system is powered up. "Data Uploads" only come in when you haul the probes. If you were out fishing and don't see your approximate locations on here, please reach out because there may be a problem with your system.
### NECOFS Bottom Temperature Forecast
![NECOFS gif](NECOFS.gif)
### Announcements

All the best,
George and JiM
